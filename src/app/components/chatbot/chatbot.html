<!-- src/app/components/chatbot/chatbot.component.html -->

<!-- Botón flotante para abrir el chat -->
<div class="chatbot-toggle" 
     [class.chat-abierto]="chatAbierto"
     (click)="toggleChat()">
  
  <!-- Tooltip de ayuda -->
  <div class="chat-tooltip" *ngIf="!chatAbierto">
    ¿En qué puedo ayudarte?
  </div>
  <svg *ngIf="!chatAbierto" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" stroke-width="2"/>
    <line x1="9" y1="10" x2="15" y2="10" stroke-width="2"/>
    <line x1="9" y1="14" x2="13" y2="14" stroke-width="2"/>
  </svg>
  <svg *ngIf="chatAbierto" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
    <line x1="18" y1="6" x2="6" y2="18" stroke-width="2"/>
    <line x1="6" y1="6" x2="18" y2="18" stroke-width="2"/>
  </svg>
</div>

<!-- Ventana del chatbot -->
<div class="chatbot-container" *ngIf="chatAbierto">
  
  <!-- Header -->
  <div class="chatbot-header">
    <div class="header-info">
      <div class="bot-avatar">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <rect x="3" y="11" width="18" height="10" rx="2" stroke-width="2"/>
          <circle cx="12" cy="5" r="2" stroke-width="2"/>
          <path d="M12 7v4" stroke-width="2"/>
          <line x1="8" y1="16" x2="8" y2="16" stroke-width="2" stroke-linecap="round"/>
          <line x1="16" y1="16" x2="16" y2="16" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>
      <div class="header-text">
        <h3>VincuHub Assistant</h3>
        <span class="estado-online">En línea</span>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn-header" (click)="limpiarChat()" title="Limpiar conversación">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <polyline points="3 6 5 6 21 6" stroke-width="2"/>
          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke-width="2"/>
        </svg>
      </button>
      <button class="btn-header btn-close-chat" (click)="cerrarChat()" title="Cerrar chat">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <line x1="18" y1="6" x2="6" y2="18" stroke-width="2"/>
          <line x1="6" y1="6" x2="18" y2="18" stroke-width="2"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mensajes -->
  <div class="chatbot-mensajes" #mensajesContainer>
    
    <!-- Mensajes del chat -->
    <div *ngFor="let mensaje of mensajes" 
         class="mensaje-wrapper"
         [class.mensaje-usuario]="mensaje.esUsuario"
         [class.mensaje-bot]="!mensaje.esUsuario">
      
      <div class="mensaje-avatar" *ngIf="!mensaje.esUsuario">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <rect x="3" y="11" width="18" height="10" rx="2" stroke-width="2"/>
          <circle cx="12" cy="5" r="2" stroke-width="2"/>
          <path d="M12 7v4" stroke-width="2"/>
        </svg>
      </div>

      <div class="mensaje-contenido">
        <div class="mensaje-bubble" [class.enviando]="mensaje.enviando">
          <p>{{ mensaje.contenido }}</p>
          <span class="mensaje-hora">{{ getHoraFormateada(mensaje.timestamp) }}</span>
        </div>
      </div>

      <div class="mensaje-avatar mensaje-avatar-usuario" *ngIf="mensaje.esUsuario">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke-width="2"/>
          <circle cx="12" cy="7" r="4" stroke-width="2"/>
        </svg>
      </div>
    </div>

    <!-- Preguntas frecuentes (después de los mensajes) -->
    <div class="preguntas-frecuentes" *ngIf="mostrarPreguntasFrecuentes">
      <p class="preguntas-titulo">Preguntas frecuentes:</p>
      <div class="preguntas-grid">
        <button 
          *ngFor="let pregunta of preguntasFrecuentes" 
          class="pregunta-btn"
          (click)="seleccionarPregunta(pregunta.pregunta)">
          {{ pregunta.pregunta }}
        </button>
      </div>
    </div>
  </div>

  <!-- Input de mensaje -->
  <div class="chatbot-input">
    <textarea
      [(ngModel)]="nuevoMensaje"
      (keydown)="onEnter($event)"
      placeholder="Escribe tu mensaje..."
      rows="1"
      [disabled]="enviando"
      class="input-mensaje"></textarea>
    <button 
      class="btn-enviar"
      (click)="enviarMensaje()"
      [disabled]="!nuevoMensaje.trim() || enviando"
      title="Enviar mensaje">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <line x1="22" y1="2" x2="11" y2="13" stroke-width="2"/>
        <polygon points="22 2 15 22 11 13 2 9 22 2" stroke-width="2"/>
      </svg>
    </button>
  </div>

  <!-- Footer -->
  <div class="chatbot-footer">
    <span>Powered by ChatGPT</span>
  </div>
</div>